<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Solana Devnet Airdrop</title>

<script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>

<style>
  :root {
    --bg: #020617;
    --accent: #38bdf8;
    --accent2: #a855f7;
    --text: #e5e7eb;
    --text-soft: #9ca3af;
    --success: #4ade80;
    --danger: #f97373;
  }

  body {
    margin: 0;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background:
      radial-gradient(circle at top, rgba(56,189,248,.12), transparent 60%),
      radial-gradient(circle at bottom, rgba(168,85,247,.15), transparent 55%),
      var(--bg);
    color: var(--text);
    font-family: system-ui, sans-serif;
    padding: 20px;
  }

  .shell {
    width: 100%;
    max-width: 480px;
  }

  .card {
    border-radius: 24px;
    padding: 2px;
    background:
      radial-gradient(circle at 0% 0%, rgba(56,189,248,.6), transparent 55%),
      radial-gradient(circle at 100% 100%, rgba(168,85,247,.7), transparent 55%);
    box-shadow: 0 0 40px rgba(56,189,248,0.2), 0 0 60px rgba(15,23,42,0.8);
  }

  .card-inner {
    border-radius: 22px;
    background: radial-gradient(circle at top left, rgba(15,23,42,.9), #020617);
    padding: 24px 22px 26px;
  }

  .badge {
    font-size: 11px;
    padding: 5px 10px;
    border-radius: 999px;
    background: rgba(15,23,42,.9);
    border: 1px solid rgba(148,163,184,.3);
    color: var(--text-soft);
    display:flex;
    align-items:center;
    gap:6px;
  }

  .pulse-dot {
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: var(--accent);
    box-shadow: 0 0 12px rgba(56,189,248,.9);
  }

  .subtitle {
    font-size: 13px;
    margin-top:8px;
    color: var(--text-soft);
    line-height: 1.5;
  }

  .admin-balances, .admin-wallet {
    font-size: 12px;
    margin-top: 12px;
    color: var(--text-soft);
    word-break: break-all;
  }

  .row { display:flex; flex-direction:column; gap:8px; margin:20px 0; }

  .btn-row { display:flex; gap:8px; }

  button {
    flex: 1;
    border: none;
    padding: 11px;
    border-radius: 999px;
    font-size: 13px;
    cursor: pointer;
  }

  .btn-phantom { background:linear-gradient(135deg,#6366f1,#8b5cf6); color:white; }
  .btn-airdrop { background:linear-gradient(135deg,#22c55e,#22d3ee); color:#022c22; }

  .disabled { opacity: .35; pointer-events:none; }

  #cooldown { font-size: 12px; color: var(--accent); margin-top:8px; }

  #status { font-size: 13px; margin-top:12px; min-height:20px; }
  #status.ok { color: var(--success); }
  #status.err { color: var(--danger); }

</style>
</head>

<body>
<div class="shell">
  <div class="card">
    <div class="card-inner">

      <div class="badge">
        <span class="pulse-dot"></span> Solana Devnet Â· Airdrop
      </div>

      <h2 style="margin:10px 0;">Airdrop Station</h2>
      <div class="subtitle">
        Daily limit: <b>once per wallet & IP</b><br>
        Reward: <b>0.1 SOL + 1000 TOKEN</b>
      </div>

      <div class="admin-wallet" id="adminWalletDisplay">Loading admin wallet...</div>
      <div class="admin-balances" id="adminBalances">Loading admin balances...</div>

      <div class="row">
        <label>Connected wallet <span id="walletStatus" style="color:#9ca3af;">Not connected</span></label>
        <input id="walletInput" placeholder="Enter wallet address">

        <div class="btn-row">
          <button class="btn-phantom" id="btnPhantom">Connect Phantom</button>
          <button class="btn-airdrop" id="btnAirdrop" disabled>Get Airdrop</button>
        </div>

        <div id="cooldown"></div>
        <div id="status"></div>
      </div>

    </div>
  </div>
</div>


<script>
const btnPhantom = document.getElementById("btnPhantom");
const btnAirdrop = document.getElementById("btnAirdrop");
const walletInput = document.getElementById("walletInput");
const statusBox = document.getElementById("status");
const cooldownBox = document.getElementById("cooldown");
const adminWalletDisplay = document.getElementById("adminWalletDisplay");
const adminBalancesEl = document.getElementById("adminBalances");

// Backend API endpoints
const API_AIRDROP = "/api/airdrop.php";
const API_BALANCE = "/api/balance.php";

function setStatus(msg, type="") {
  statusBox.className = type;
  statusBox.innerHTML = msg;
}

/* ========== Load admin wallet & balances ========== */
async function loadAdminStatus() {
  const res = await fetch(API_BALANCE);
  const json = await res.json();

  adminWalletDisplay.innerHTML = `<b>Admin Wallet:</b> ${json.admin_wallet}`;
  adminBalancesEl.innerHTML = `
    <b>Admin SOL:</b> ${json.sol} SOL<br>
    <b>Admin TOKEN:</b> ${json.token} TOKEN
  `;
}

/* ========== Phantom connect ========== */
btnPhantom.addEventListener("click", async () => {
  try {
    const provider = window.solana;
    if (!provider || !provider.isPhantom) {
      return setStatus("Phantom not installed", "err");
    }
    const resp = await provider.connect();
    const addr = resp.publicKey.toString();
    walletInput.value = addr;
    setStatus("Phantom connected", "ok");
    btnAirdrop.disabled = false;
  } catch (err) {
    setStatus("Phantom connect failed", "err");
  }
});

/* ========== Airdrop via PHP backend ========== */
btnAirdrop.addEventListener("click", async () => {
  const wallet = walletInput.value.trim();
  if (!wallet) return setStatus("Enter a wallet", "err");

  setStatus("Processing...", "");
  btnAirdrop.disabled = true;

  try {
    const res = await fetch(API_AIRDROP, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify({ wallet })
    });

    const json = await res.json();

    if (json.status === "success") {
      setStatus("Airdrop complete!", "ok");
    } else {
      setStatus(json.message, "err");
    }

    loadAdminStatus();
  } catch (err) {
    setStatus("Request failed: " + err.message, "err");
  }

  btnAirdrop.disabled = false;
});

/* Init */
loadAdminStatus();
</script>

</body>
</html>
